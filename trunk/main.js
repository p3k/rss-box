$(function(){function a(a){var e=d();if(e.url!==window.rss.config.url){b(e);return}window.rss.renderBox(window.rss.data,e,function(a){$("#preview").html(a),c(window.rss.data,e)})}function b(a){var b=e(a);$("#reload").attr("disabled",!0).css("color","gray"),$("#source").text("Loading...").css("color","green"),window.rss=null,window._rss_box_framework_has_loaded=null;var d=document.createElement("script");d.src=BASE_URI+"index.js?setup=true&"+b,d.type="text/javascript",d.onreadystatechange=d.onload=function(){},$("#preview").empty().get(0).appendChild(d);var f=setInterval(function(){typeof jQuery!="undefined"&&window.rss&&(clearTimeout(f),c(window.rss.data,window.rss.config),window.rss.data.error?($("#source a").css("color","red"),$("#code textarea").attr("disabled",!0)):$("#code textarea").attr("disabled",!1),$("#reload").css("color","green").attr("disabled",!1))},10)}function c(a,b){$("#url").val(b.url),$("#source").html('<a href="'+b.url+'">'+a.format+" "+a.version+"</a>"),$("#title").text(a.title),$("#description").text(a.description).hide(),$("#descriptionToggler").show(),$("#date").text($(".rssbox-date").text()),$("#format").text(a.format+" "+a.version),$("#maxItems").val(b.maxItems),$("#width").val(b.width),$("#preview").css("width",b.width),$("#radius").val(b.radius),$("#align").val(b.align||"default"),$("#compact").prop("checked",!!b.compact),$("#showXmlButton").prop("checked",!!b.showXmlButton),$("#fontFace").val(b.fontFace),$("#frameColor").miniColors("value",b.frameColor),$("#titleBarColor").miniColors("value",b.titleBarColor),$("#titleBarTextColor").miniColors("value",b.titleBarTextColor),$("#boxFillColor").miniColors("value",b.boxFillColor),$("#textColor").miniColors("value",b.textColor),$("#linkColor").miniColors("value",b.linkColor),$("#code textarea").val('<script type="text/javascript" src="'+BASE_URI+"index.js?"+e(b).replace(/&/g,"&amp;")+'"></script>');return}function d(){var a={},b=["url","maxItems","width","radius","align","frameColor","titleBarColor","titleBarTextColor","boxFillColor","textColor","linkColor","fontFace"];for(var c=0;c<b.length;c+=1){var d=b[c];a[d]=$("#"+d).val()}return a.compact=$("#compact").prop("checked")&&!0,a.showXmlButton=$("#showXmlButton").prop("checked")&&!0,a}function e(a){if(!a)return"";var b=[];for(var c in a){var d=a[c];if(c==="setup"||!d)continue;b.push(c+"="+encodeURIComponent(d))}return b.join("&")}BASE_URI="http://p3k.org/rss/",FERRIS_URI="http://3.p3k-001.appspot.com/ferris?callback=?&group=rssbox&limit=100",b({url:"http://blog.p3k.org/rss.xml",maxItems:7,width:200,radius:5,align:null,frameColor:"#B3A28E",titleBarColor:"#90A8B3",titleBarTextColor:"#FFEAD2",boxFillColor:"#FFEAD2",textColor:"#95412B",linkColor:"#2C7395",showXmlButton:!0,compact:!1,fontFace:"10pt sans-serif"}),$("input:text").change(a),$("input:checkbox").click(a),$("form").submit(function(b){b.preventDefault(),a()}),$("#code textarea").click(function(){$(this).select()}),$(".toggler a").click(function(){return $(this).parents(".toggler").next(".togglee").toggle(),!1}).click(),$("#descriptionToggler").click(function(){return $(this).hide(),$("#description").show(),!1}),$(".color").miniColors({change:function(b,c){a()}}),$("#referrers").hide(),$("#referrersToggle").click(function(){return $.getJSON(FERRIS_URI,function(a){var b={},c="";$.each(a,function(a,d){if(this.url.indexOf(BASE_URI)>-1)return;var d=this.url.replace(/^([^.]*)www\./,"$1");if(b[d])return;b[d]=!0;var e=d.split("/")[2];c+='<a href="'+d+'">'+e+"<"+"/a><br />"}),$("#referrers").html(c).show(),$("#referrersToggle").hide()}),!1}),$('a[href$="\\.xml"]').click(function(b){b.preventDefault(),$("#url").val($(this).attr("href")),a()})})